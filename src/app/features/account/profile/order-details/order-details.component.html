<section class="py-5 mt-5" #print>
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-xl-center">
      <h2 class="mb-0 hide">
        <i
          routerLink="/account/profile/my-orders"
          class="bi-arrow-left cursor"
        ></i>
        <span> Order Details</span>
      </h2>
      <div
        id="hide"
        class="text-orange text-decoration-underline fw-bold cursor print"
        (click)="printInvoice()"
      >
        Print<span class="mx-1"><i class="bi bi-printer text-orange"></i></span>
      </div>
    </div>
    <div class="p-4 bg-white">
      <div class="d-flex align-items-center">
        <img
          src="/assets/ridge-logo.png"
          width="5%"
          alt=""
          class="img-fluid logo"
        />
        <h3 class="text-center fw-bold text-center w-100">Invoice</h3>
      </div>
      <hr class="border mt-0 mb-4" />
      <div class="row">
        <div class="mb-2">
          <label>Order ID : </label>
          <span> {{ selectedOrder?.orderId }}</span>
        </div>
        <div class="mb-2">
          <label>Order Date : </label>
          <span> {{ selectedOrder?.createdAt | date : "MM/dd/yyyy" }}</span>
        </div>
        <div
          class="text-danger"
          *ngIf="
            selectedOrder?.cutType === 2 && selectedOrder?.paymentStatus == 1
          "
        >
          <label for=""
            >If you haven not filled the Google sheet for custom cut details
            please fill it here &nbsp;</label
          >
          <a
            class="text-orange fw-bold"
            href="https://docs.google.com/forms/d/e/1FAIpQLSdOuwOSuawMOIri4gf9XD_IfK-jwB26HdyNlqBpRTafemwYQA/viewform?vc=0&c=0&w=1&flr=0"
            target="_blank"
          >
            Google Form
          </a>
        </div>
        <div class="col-md-6 pt-3">
          <div class="mb-2">
            <span class="text-capitalize">
              {{
                selectedOrder?.user.firstName +
                  " " +
                  selectedOrder?.user.lastName
              }}
            </span>
          </div>
          <div class="mb-2">
            <span> {{ selectedOrder?.user.email }}</span>
          </div>
          <div class="mb-2">
            <span> {{ selectedOrder?.user.phoneNumber }}</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="py-5">
            <div style="font-weight: bolder" class="small-title">
              Self Pickup Address:
            </div>
            <span>San Gabriel River In Liberty Hill, Austin, Texas -73301</span>
          </div>
          <div *ngIf="!selectedOrder?.isSelfPickup">
            <div class="small-title">Shipping Address</div>
            <hr class="border" />
            <div class="d-flex flex-column">
              <span>
                {{ selectedOrder ? selectedOrder["address1"] : "" }} in
                {{ selectedOrder ? selectedOrder["city"] : "" }},
                {{ selectedOrder ? selectedOrder["state"] : "" }},{{
                  selectedOrder ? selectedOrder["country"] : ""
                }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="row py-4">
        <h4>Order Summary</h4>
        <hr class="border" />
        <div class="table-responsive mb-2">
          <table class="table table-borderless border">
            <thead>
              <tr class="border-bottom">
                <th scope="col">Product</th>
                <th scope="col">Quntity</th>
                <th scope="col">Price</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedOrder?.orderItemDetails">
                <td>{{ item.name }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ item.unitPrice }}</td>
              </tr>
              <tr class="border-top">
                <td colspan="1"></td>
                <td class="text-end text-nowrap">
                  <label>Sub Total : </label>
                </td>
                <td>${{ selectedOrder?.subTotalAmount }}</td>
              </tr>
              <tr>
                <td colspan="1"></td>
                <td class="text-end text-nowrap"><label>Tax : </label></td>
                <td>${{ selectedOrder?.tax }}</td>
              </tr>
              <tr class="align-baseline border-top">
                <td colspan="1"></td>
                <td class="text-end text-nowrap">
                  <label class="fs-4">Total : </label>
                </td>
                <td class="fs-4">${{ selectedOrder?.totalAmount }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="mb-2">
          <label>Payment Status : </label>
          <span
            class="ms-2 {{
              commonService.getPaymentStatus(selectedOrder?.paymentStatus)
                ?.color
            }}"
          >
            {{
              commonService.getPaymentStatus(selectedOrder?.paymentStatus)
                ?.status
                ? commonService.getPaymentStatus(selectedOrder?.paymentStatus)
                    ?.status
                : "--"
            }}
          </span>
        </div>
        <div class="mb-2">
          <label>Payment Date : </label>
          <span>
            {{
              selectedOrder?.paymentDate
                ? (selectedOrder.paymentDate | date : "MM/dd/yyyy")
                : "--"
            }}
          </span>
        </div>
        <!--<div class="mb-2">
            <label> Payment Method : </label>
            <span> Credit Card (Visa **** 1234)</span>
          </div>-->
      </div>
    </div>

    <div class="d-flex justify-content-end pt-4 flex-column flex-md-row">
      <button
        *ngIf="
          selectedOrder?.orderStatus !== 1 && selectedOrder?.orderStatus !== 2
        "
        type="button"
        class="btn hide button-orange rounded-0 mx-3 text-light mb-3"
        (click)="openCancelDialog(true)"
      >
        Cancel Order
      </button>
      <button
        (click)="navigateToSecondPayment()"
        *ngIf="
          selectedOrder?.paymentStatus == 4 && selectedOrder?.orderStatus == 4
        "
        type="button"
        class="hide btn button-orange rounded-0 mb-3"
      >
        Make Payment
      </button>
    </div>
  </div>
</section>

<ng-template #canelOrderTemplate let-modal>
  <div class="modal-header border-bottom py-2">
    <h5 class="modal-title">Confirmation</h5>
    <i class="fas fa-times close-icon mt-2" (click)="modal.close()"></i>
  </div>
  <form [formGroup]="cancelReasonForm">
    <div class="modal-body px-2">
      <div class="mb-1">
        Please specify the reason for cancellation or date change to proceed
      </div>
      <label class="mb-2">Reason <span class="text-danger">*</span></label>
      <textarea
        [(ngModel)]="cancelReason"
        formControlName="cancelReason"
        class="form-control mb-2"
        [class.is-invalid]="isFieldValid(cancelReasonForm, 'cancelReason')"
      >
      </textarea>
      <span
        class="text-orange"
        *ngIf="hasError(cancelReasonForm, 'cancelReason', 'required')"
        >Please enter reason for cancel.
      </span>
    </div>
    <div class="modal-footer mt-2 d-flex justify-content-end">
      <button
        type="button"
        class="btn rounded-0 button-orange me-2 py-1 text-light"
        (click)="cancelOrder()"
      >
        Confirm Cancel
      </button>
      <button class="btn btn-light-primary" (click)="modal.close()">
        Close
      </button>
    </div>
  </form>
</ng-template>
