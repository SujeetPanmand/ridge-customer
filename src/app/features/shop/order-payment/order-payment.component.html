<section class="py-5 mt-5 bg-light-gray">
  <div class="container">
    <div class=" ">
      <app-bread-crumb [links]="links" *ngIf="isLoggedIn"></app-bread-crumb>

      <h1 class="sub-title pt-3">
        Order Payment
        <span class="h4">({{ orderPaymentDetails?.orderId }})</span>
      </h1>
      <div class="row pt-4">
        <div class="col-md-6 mx-auto bg-white p-4">
          <h4>Payment Summary:</h4>
          <table class="table table-borderless border">
            <tbody>
              <tr>
                <td>Balance Due</td>
                <td></td>
                <td class="text-end">${{ orderPaymentDetails?.payment }}</td>
              </tr>
              <tr>
                <td>Shipping</td>
                <td></td>
                <td class="text-end">
                  ${{
                    orderPaymentDetails?.isSelfPickUp
                      ? 0
                      : orderPaymentDetails?.shippingCharge
                  }}
                </td>
              </tr>
              <tr class="border-bottom">
                <td>Tax</td>
                <td></td>
                <td class="text-end">${{ orderPaymentDetails?.tax }}</td>
              </tr>
              <tr class="border-bottom">
                <td class="fs-6 fw-bold">Total Balance Due</td>
                <td></td>
                <td class="text-end fs-6 fw-bold">
                  ${{
                    !orderPaymentDetails?.isSelfPickUp
                      ? orderPaymentDetails?.payment +
                        orderPaymentDetails?.shippingCharge +
                        orderPaymentDetails?.tax
                      : orderPaymentDetails?.payment + orderPaymentDetails?.tax
                  }}
                </td>
              </tr>
            </tbody>
          </table>
          <h4 class="text-title">Payment Method</h4>
          <hr class="border" />
          <form [formGroup]="paymentForm">
            <div class="d-flex">
              <div class="form-check">
                <!-- <input
                  class="form-check-input"
                  type="radio"
                  name="flexRadioDefault"
                  id="flexRadioDefault1"
                /> -->
                <i class="bi bi-credit-card"></i>
                <span class="px-1"> Credit Card </span>
              </div>
            </div>
            <div class="bg-light-gray mt-4 p-4">
              <div class="mb-3">
                <label for="cardNumber" class="form-label"> Card Number</label>

                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="XXXX-XXXX-XXXX-9817"
                    formControlName="cardNumber"
                    maxlength="23"
                    [class.is-invalid]="isFieldValid(paymentForm, 'cardNumber')"
                    (ngModelChange)="this.checkCardType.next($event)"
                    (input)="formatCardNumber($event)"
                  />
                  <span
                    class="input-group-text eye-inside bg-transparent border-start-0"
                  >
                    <a>
                      <i
                        *ngIf="!cardImage"
                        class="fas fa-credit-card"
                        aria-hidden="true"
                      ></i>
                    </a>
                    <img class="card_c" *ngIf="cardImage" [src]="cardImage" />
                  </span>
                </div>
                <span
                  class="text-danger"
                  *ngIf="hasError(paymentForm, 'cardNumber', 'required')"
                >
                  Please enter a card number.
                </span>
                <span
                  class="text-danger"
                  *ngIf="
                    hasError(paymentForm, 'cardNumber', 'invalidCardNumber')
                  "
                >
                  Please enter a valid 16-digit card number.
                </span>
              </div>
              <div class="row">
                <div class="mb-3 col-md-4">
                  <label for="exp" class="form-label">Expiry Month</label>
                  <select
                    formControlName="expiryMonth"
                    id="expiryMonth"
                    name="expiryMonth"
                    class="form-select"
                    [class.is-invalid]="
                      isFieldValid(paymentForm, 'expiryMonth')
                    "
                  >
                    <option value="">Select Month</option>
                    <option value="01">January</option>
                    <option value="02">February</option>
                    <option value="03">March</option>
                    <option value="04">April</option>
                    <option value="05">May</option>
                    <option value="06">June</option>
                    <option value="07">July</option>
                    <option value="08">August</option>
                    <option value="09">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>

                    <!-- <option *ngFor="let unit of months" [value]="unit.id">
                      {{ unit.month }}
                    </option> -->
                  </select>

                  <span
                    class="text-danger"
                    *ngIf="hasError(paymentForm, 'expiryMonth', 'required')"
                    >Please select expiry month.
                  </span>
                  <span class="text-danger" *ngIf="onSelectMonth"
                    >Please select valid expiry month.
                  </span>
                </div>
                <div class="mb-3 col-md-4">
                  <label for="exp" class="form-label">Expiry Year</label>
                  <select
                    formControlName="expiryYear"
                    id="expiryYear"
                    name="expiryYear"
                    class="form-select"
                    [class.is-invalid]="isFieldValid(paymentForm, 'expiryYear')"
                  >
                    <option value="">Select Year</option>
                    <option *ngFor="let unit of years" [value]="unit.id">
                      {{ unit.year }}
                    </option>
                  </select>

                  <span
                    class="text-danger"
                    *ngIf="hasError(paymentForm, 'expiryYear', 'required')"
                    >Please select expiry year.
                  </span>
                </div>
                <div class="mb-3 col-md-4">
                  <label for="cvv" class="form-label">CVV</label>
                  <input
                    type="text"
                    id="cvv"
                    name="cvv"
                    class="form-control"
                    placeholder="---"
                    formControlName="cvv"
                    [class.is-invalid]="isFieldValid(paymentForm, 'cvv')"
                  />
                  <span
                    class="text-danger"
                    *ngIf="hasError(paymentForm, 'cvv', 'required')"
                    >Please enter a cvv.
                  </span>
                  <span
                    class="text-danger"
                    *ngIf="
                      paymentForm.get('cvv').hasError('minlength') ||
                      paymentForm.get('cvv').hasError('maxlength')
                    "
                  >
                    CVV must be a 3-digit number.
                  </span>
                  <span
                    class="text-danger"
                    *ngIf="paymentForm.get('cvv').hasError('pattern')"
                  >
                    CVV must contain only numeric characters.
                  </span>
                </div>
              </div>
              <div class="mb-3">
                <label for="cardHoldNumber" class="form-label"
                  >Cardholder Name</label
                >
                <input
                  type="text"
                  id="cardHolderName"
                  name="cardHolderName"
                  class="form-control"
                  placeholder="Enter cardholder's full name"
                  formControlName="cardHolderName"
                  [class.is-invalid]="
                    isFieldValid(paymentForm, 'cardHolderName')
                  "
                />
                <span
                  class="text-danger"
                  *ngIf="hasError(paymentForm, 'cardHolderName', 'required')"
                  >Please enter a cardholder name.
                </span>
              </div>
              <button
                (click)="createOrder()"
                class="btn button-orange w-100 mt-4"
                type="button"
              >
                Pay Total Balance Due ${{
                  !orderPaymentDetails?.isSelfPickUp
                    ? orderPaymentDetails?.payment +
                      orderPaymentDetails?.shippingCharge +
                      orderPaymentDetails?.tax
                    : orderPaymentDetails?.payment + orderPaymentDetails?.tax
                }}
                <!-- <div
                  *ngIf="isLoading"
                  class="ml-2 spinner-border spinner-border-sm text-light"
                  role="status"
                >
                  <span class="sr-only">Loading...</span>
                </div>
                <i
                  style="color: white"
                  *ngIf="!isLoading"
                  class="fas fa-paper-plane ml-2"
                  aria-hidden="true"
                ></i> -->
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
